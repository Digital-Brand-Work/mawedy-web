<div
	(click)="patientListIsFocused = false"
	*ngIf="opened$ | async"
	@slideInRight
	@slideOutRight
	stop-propagation
	class="ml-auto bg-white h-full w-full md:w-1/4"
>
	<modal-header
		modalTitle="New Appointment"
		(onClose)="opened$.next(false)"
	></modal-header>

	<div
		class="px-10 py-5 bg-white"
		style="max-height: calc(100vh - 5vh); overflow-y: scroll !important"
	>
		<div class="font-bold text-gray-500 mb-3">Patient Details</div>

		<!-- TODO: Dropdown Menu  -->
		<div
			@fadeOutTop
			@slideInBottom
			*ngIf="(patients$ | async) && (patients$ | async)?.length !== 0"
			class="mb-5 w-full"
		>
			<label for="" class="mb-1 font-bold accent-color text-base">
				Patient Name
			</label>

			<input
				#input
				stop-propagation
				(click)="patientListIsFocused = true"
				[(ngModel)]="keyword"
				type="text"
				class="datalist py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
				list="patient-list"
			/>

			<div
				@fadeInTop
				*ngIf="
					patientListIsFocused &&
					(patients$ | async | filter: keyword).length !== 0
				"
				class="w-full shadow-md rounded-md p-3 mb-5"
			>
				<button
					(click)="
						patientListIsFocused = false;
						keyword =
							patient.first_name +
							' ' +
							patient.middle_name +
							' ' +
							patient.last_name;
						form.value.patient_id = patient.id
					"
					class="w-full hover:bg-emerald-500 hover:text-white flex items-center px-2 border border-b-gray-200"
					mat-menu-item
					*ngFor="
						let patient of patients$ | async | filter: keyword;
						trackBy: identity
					"
				>
					<img
						class="h-8 w-8 rounded-full mr-3"
						[src]="patient.picture.url"
						alt=""
					/>

					<div>
						{{ patient.first_name }} {{ patient.middle_name }}
						{{ patient.last_name }}
					</div>
				</button>
			</div>
		</div>

		<div
			@fadeOutTop
			@slideInBottom
			*ngIf="departments.length !== 0"
			class="mb-5"
		>
			<label for="" class="mb-1 font-bold accent-color text-base">
				Select Department
			</label>

			<select
				(change)="setMedicalServices($event.target.value)"
				class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
			>
				<option
					[value]="department.id"
					*ngFor="let department of departments; trackBy: identity"
				>
					{{ department.name }}
				</option>
			</select>
		</div>

		<div
			@slideInBottom
			*ngIf="medicalServices && medicalServices.length !== 0"
			class="mb-5"
		>
			<label for="" class="mb-1 font-bold accent-color text-base">
				Select Service
			</label>

			<select
				class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
			>
				<option
					*ngFor="let service of medicalServices; trackBy: identity"
				>
					{{ service.name }}
				</option>
			</select>

			<div class="text-sm text-rose-500">Service is required.</div>
		</div>

		<div
			role="button"
			class="mb-5"
			(click)="dashboardAppointmentSelectDoctorModalOpened$.next(true)"
		>
			<div class="pointer-events-none">
				<label for="" class="mb-1 font-bold accent-color text-base">
					Select Doctor
				</label>

				<select
					class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
				>
					<option>Select Doctor</option>
				</select>
			</div>
			<div class="text-sm text-rose-500">Doctor is required.</div>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-2 md:gap-x-5 items-center">
			<div class="mb-5">
				<label for="" class="mb-1 font-bold accent-color text-base">
					Select date
				</label>

				<input
					type="date"
					class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
				/>

				<div class="text-sm text-rose-500">Date is required.</div>
			</div>

			<div
				(click)="
					dashboardAppointmentSelectTimeSlotModalOpened$.next(true)
				"
				class="mb-5"
			>
				<div for="" class="pointer-events-none">
					<label for="" class="mb-1 font-bold accent-color text-base">
						Select Time
					</label>

					<input
						type="time"
						class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
					/>
				</div>

				<div class="text-sm text-rose-500">Time is required.</div>
			</div>

			<div class="mb-5">
				<label for="" class="mb-1 font-bold accent-color text-base"
					>Amount</label
				>

				<input
					*ssrExclude
					[inputMask]="currencyInputMask"
					[formControl]="currencyFC"
					placeholder="AED 0.00"
					class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
				/>

				<div class="text-sm text-rose-500">Amount is required.</div>
			</div>

			<mat-radio-group class="-translate-y-2">
				<mat-radio-button value="1">Waiting Patient</mat-radio-button>
			</mat-radio-group>
		</div>

		<div class="mb-5">
			<label
				for=""
				class="mb-1 font-bold accent-color text-base flex items-center"
			>
				<div>Comments</div>
				<div class="ml-auto text-gray-400">(Optional)</div>
			</label>

			<textarea
				(keyup)="autoGrow()"
				#comments
				class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
			></textarea>
		</div>

		<div
			class="w-full py-5 z border-t border-t-gray-100 flex items-center mb-5"
		>
			<button
				mat-flat-button
				(click)="opened$.next(false)"
				class="hover:bg-gray-50 rounded-xl px-5 py-3 font-bold border-2 border-gray-300 text-gray-400 ml-auto mr-3"
			>
				Cancel
			</button>

			<button
				mat-flat-button
				class="hover:bg-emerald-600 rounded-xl px-5 py-3 font-bold text-white bg-emerald-500 border-2 border-emerald-500"
			>
				Schedule
			</button>
		</div>
	</div>
</div>
