<div
	(click)="patientListIsFocused = false"
	*ngIf="opened$ | async"
	@slideInRight
	@slideOutRight
	stop-propagation
	class="ml-auto bg-white h-full w-full md:w-1/4"
	style="min-width: 500px"
>
	<modal-header
		modalTitle="New Appointment"
		(onClose)="opened$.next(false)"
	></modal-header>

	<form
		*ngIf="form"
		[formGroup]="form"
		#ngForm="ngForm"
		class="px-10 py-5 bg-white"
		style="max-height: calc(100vh - 5vh); overflow-y: scroll !important"
	>
		<div class="font-bold text-gray-500 mb-3">Patient Details</div>

		<div
			@fadeOutTop
			@slideInBottom
			*ngIf="(patients$ | async) && (patients$ | async)?.length !== 0"
			class="mb-5 w-full"
		>
			<label for="" class="mb-1 font-bold accent-color text-base">
				Patient Name
			</label>

			<input
				stop-propagation
				(click)="patientListIsFocused = true"
				[ngModelOptions]="{ standalone: true }"
				[(ngModel)]="keyword"
				type="text"
				class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
			/>

			<div
				@fadeInTop
				*ngIf="
					patientListIsFocused &&
					(patients$ | async | filter: keyword).length !== 0
				"
				class="w-full shadow-md rounded-md p-3 mb-5"
			>
				<button
					(click)="
						patientListIsFocused = false;
						keyword =
							patient.first_name +
							' ' +
							patient.middle_name +
							' ' +
							patient.last_name;
						form.value.patient_id = patient.id
					"
					class="w-full hover:bg-emerald-500 hover:text-white flex items-center px-2 border border-b-gray-200"
					mat-menu-item
					*ngFor="
						let patient of patients$ | async | filter: keyword;
						trackBy: identity
					"
				>
					<img
						class="h-8 w-8 rounded-full mr-3"
						[src]="patient.picture.url"
						alt=""
					/>

					<div>
						{{ patient.first_name }} {{ patient.middle_name }}
						{{ patient.last_name }}
					</div>
				</button>
			</div>
		</div>

		<div
			@fadeOutTop
			@slideInBottom
			*ngIf="departments.length !== 0"
			class="mb-5"
		>
			<label
				for="department_id"
				class="mb-1 font-bold accent-color text-base"
			>
				Select Department
			</label>

			<select
				id="department_id"
				formControlName="department_id"
				(change)="setMedicalServices($event.target.value)"
				class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
			>
				<option
					[value]="department.id"
					*ngFor="let department of departments; trackBy: identity"
				>
					{{ department.name }}
				</option>
			</select>
		</div>

		<div
			@slideInBottom
			*ngIf="medicalServices && medicalServices.length !== 0"
			class="mb-5"
		>
			<label
				for="service_id"
				class="mb-1 font-bold accent-color text-base"
			>
				Select Service
			</label>

			<select
				id="service_id"
				formControlName="service_id"
				class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
			>
				<option
					*ngFor="let service of medicalServices; trackBy: identity"
				>
					{{ service.name }}
				</option>
			</select>
		</div>

		<div
			*ngIf="(doctor$ | async) && (doctor$ | async) !== null"
			@slideInBottom
			role="button"
			class="mb-5"
			(click)="dashboardAppointmentSelectDoctorModalOpened$.next(true)"
		>
			<div class="pointer-events-none">
				<label
					for="doctor_id"
					class="mb-1 font-bold accent-color text-base"
				>
					Select Doctor
				</label>

				<input
					[ngModelOptions]="{ standalone: true }"
					[value]="(doctor$ | async)?.name"
					type="text"
					class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
				/>
			</div>
		</div>

		<div
			*ngIf="(doctor$ | async) && (doctor$ | async) !== null"
			@slideInBottom
			class="grid grid-cols-1 md:grid-cols-2 md:gap-x-5 items-center"
		>
			<div class="mb-5">
				<label for="date" class="mb-1 font-bold accent-color text-base">
					Select date
				</label>

				<input
					id="date"
					formControlName="date"
					type="date"
					[ngClass]="{
						'border-red-500':
							form.get('date')?.touched &&
							!form.get('date')?.valid,
						'text-red-500': errors.date
					}"
					class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
				/>

				<div
					*ngIf="
						form.get('date')?.touched && !form.get('date')?.valid
					"
					class="text-sm text-rose-500"
				>
					Date is required.
				</div>
			</div>

			<div
				(click)="
					dashboardAppointmentSelectTimeSlotModalOpened$.next(true)
				"
				class="mb-5"
			>
				<div for="" class="pointer-events-none">
					<label for="" class="mb-1 font-bold accent-color text-base">
						Select Time
					</label>

					<input
						type="time"
						class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
					/>
				</div>
			</div>

			<div class="mb-5">
				<label for="type" class="mb-1 font-bold accent-color text-base"
					>Appointment Type</label
				>

				<select
					id="type"
					formControlName="type"
					class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
					[ngClass]="{
						'border-red-500':
							form.get('type')?.touched &&
							!form.get('type')?.valid,
						'text-red-500': errors.type
					}"
				>
					<option
						*ngFor="let item of appointmentTypes; trackBy: identity"
					>
						{{ item }}
					</option>
				</select>

				<div
					*ngIf="
						form.get('type')?.touched && !form.get('type')?.valid
					"
					class="text-sm text-rose-500"
				>
					>Amount is required.
				</div>
			</div>

			<div class="mb-5">
				<label for="price" class="mb-1 font-bold accent-color text-base"
					>Amount</label
				>

				<input
					id="price"
					formArrayName="price"
					*ssrExclude
					[inputMask]="currencyInputMask"
					[formControl]="currencyFC"
					placeholder="AED 0.00"
					class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
					[ngClass]="{
						'border-red-500':
							form.get('price')?.touched &&
							!form.get('price')?.valid,
						'text-red-500': errors.type
					}"
				/>

				<div
					*ngIf="
						form.get('price')?.touched && !form.get('type')?.valid
					"
					class="text-sm text-rose-500"
				>
					Amount is required.
				</div>
			</div>
		</div>

		<div
			*ngIf="(doctor$ | async) && (doctor$ | async) !== null"
			@slideInBottom
			class="mb-5"
		>
			<label
				for="comments"
				class="mb-1 font-bold accent-color text-base flex items-center"
			>
				<div>Comments</div>
				<div class="ml-auto text-gray-400">(Optional)</div>
			</label>

			<textarea
				id="comments"
				formArrayName="comments"
				style="min-height: 122px"
				(keyup)="autoGrow()"
				#comments
				class="py-3 px-4 rounded-md border-gray-300/80 border w-full focus:border-teal-500 focus:border-2 focus:shadow-md focus:shadow-teal-500/20"
			></textarea>
		</div>

		<div
			class="w-full py-5 z border-t border-t-gray-100 flex items-center mb-5"
		>
			<button
				mat-flat-button
				(click)="opened$.next(false)"
				class="hover:bg-gray-50 rounded-xl px-5 py-3 font-bold border-2 border-gray-300 text-gray-400 ml-auto mr-3"
			>
				Cancel
			</button>

			<button
				mat-flat-button
				class="hover:bg-emerald-600 rounded-xl px-5 py-3 font-bold text-white bg-emerald-500 border-2 border-emerald-500"
			>
				Schedule
			</button>
		</div>
	</form>
</div>
